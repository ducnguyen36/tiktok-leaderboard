version: '3.8'

services:
  leaderboard:
    build: .
    container_name: helios-leaderboard
    restart: unless-stopped
    ports:
      # Map container port 5000 to host port 5050 (Avoids Synology DSM port 5000 conflict)
      - "5050:5000"
    environment:
      - NODE_ENV=production
      - TIKTOK_SESSION_ID=${TIKTOK_SESSION_ID}
    healthcheck:
      test: [ "CMD", "wget", "-q", "--spider", "http://localhost:5000/api/leaderboard?type=monthly" ]
      interval: 30s
      timeout: 10s
      retries: 3
  # ============================================
  # CLOUDFLARE TUNNEL - Access from anywhere!
  # Free, secure, no port forwarding needed
  # ============================================
  cloudflared:
    image: cloudflare/cloudflared:latest
    container_name: cloudflare-tunnel
    restart: unless-stopped
    # Run Quick Tunnel (No token needed, works through CGNAT)
    command: tunnel --url http://leaderboard:5000
    depends_on:
      - leaderboard
