version: '3.8'

services:
  leaderboard:
    build: .
    container_name: helios-leaderboard
    restart: unless-stopped
    ports:
      # Map container port 5000 to host port 5050 (Avoids Synology DSM port 5000 conflict)
      - "5050:5000"
    environment:
      - NODE_ENV=production
      - TIKTOK_SESSION_ID=${TIKTOK_SESSION_ID}
    healthcheck:
      test: [ "CMD", "wget", "-q", "--spider", "http://localhost:5000/api/leaderboard?type=monthly" ]
      interval: 30s
      timeout: 10s
      retries: 3
  # ============================================
  # NGROK TUNNEL - Access from anywhere!
  # Free, secure, no port forwarding needed
  # ============================================
  ngrok:
    image: ngrok/ngrok:latest
    container_name: ngrok-tunnel
    restart: unless-stopped
    command:
      - "http"
      - "http://leaderboard:5000"
      - "--authtoken=2dGpnm3LNfraYUpRrpy7N20Kb76_61mGyUrC4HGyxGowQTXFJ"
      - "--domain=uncorroborative-tachygraphic-kalyn.ngrok-free.dev"
    depends_on:
      - leaderboard
